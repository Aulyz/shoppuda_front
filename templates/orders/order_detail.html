{% extends 'base.html' %}
{% load humanize %}

{% comment %} templates/orders/order_detail.html - Complete Enhanced Version {% endcomment %}

{% block title %}ì£¼ë¬¸ ìƒì„¸ - {{ order.order_number }} - Shopuda ERP{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<meta name="csrf-token" content="{{ csrf_token }}">
<style>
/* ì¸ì‡„ ì „ìš© ìŠ¤íƒ€ì¼ */
@media print {
    body * {
        visibility: hidden;
    }
    
    .print-area, .print-area * {
        visibility: visible;
    }
    
    .print-area {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        padding: 20px;
    }
    
    .no-print {
        display: none !important;
    }
    
    /* ì¸ì‡„ ì‹œ ìƒ‰ìƒ ì¡°ì • */
    .print-header {
        background: #f8f9fa !important;
        color: #000 !important;
        border: 2px solid #000 !important;
        text-align: center;
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .print-company-info {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #000;
        padding-bottom: 20px;
    }
    
    .print-customer-info {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #000;
    }
    
    .print-table {
        border-collapse: collapse;
        width: 100%;
        margin: 20px 0;
    }
    
    .print-table th,
    .print-table td {
        border: 1px solid #000 !important;
        padding: 8px !important;
        text-align: left;
    }
    
    .print-table th {
        background-color: #f0f0f0 !important;
        font-weight: bold;
    }
    
    .print-total {
        font-size: 18px !important;
        font-weight: bold !important;
        text-align: right !important;
        margin-top: 20px !important;
        border-top: 2px solid #000;
        padding-top: 10px;
    }
    
    .print-footer {
        margin-top: 40px;
        text-align: center;
        font-size: 12px;
        color: #666;
        border-top: 1px solid #000;
        padding-top: 20px;
    }
    
    .print-timeline {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #000;
    }
    
    .print-timeline h3 {
        margin-top: 0;
        border-bottom: 1px solid #000;
        padding-bottom: 10px;
    }
}

/* ì´ë©”ì¼ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.email-modal {
    max-height: 90vh;
    overflow-y: auto;
}

.email-template-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
}

.template-option {
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.template-option:hover {
    border-color: #3b82f6;
    background-color: #f8fafc;
}

.template-option.selected {
    border-color: #3b82f6;
    background-color: #eff6ff;
}

.email-preview {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
    margin-top: 1rem;
    max-height: 300px;
    overflow-y: auto;
}

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-fade-in {
    animation: fadeInUp 0.6s ease forwards;
    opacity: 0;
}

/* ë¡œë”© ìŠ¤í”¼ë„ˆ */
.loading-spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3b82f6;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Alpine.js x-cloak */
[x-cloak] { 
    display: none !important; 
}
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300" x-data="orderDetail()">
    <!-- Breadcrumb Navigation -->
    <nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700" aria-label="Breadcrumb">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <ol class="flex items-center space-x-2 lg:space-x-4 py-4">
                <li>
                    <div>
                        <a href="{% url 'dashboard:home' %}" 
                           class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:text-gray-600 dark:focus:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 rounded-sm transition-colors duration-200"
                           aria-label="í™ˆìœ¼ë¡œ ì´ë™">
                            <i class="fas fa-home h-4 w-4 lg:h-5 lg:w-5" aria-hidden="true"></i>
                            <span class="sr-only">Home</span>
                        </a>
                    </div>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right h-4 w-4 lg:h-5 lg:w-5 text-gray-400 dark:text-gray-500" aria-hidden="true"></i>
                        <a href="{% url 'orders:list' %}" 
                           class="ml-2 lg:ml-4 text-xs lg:text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:text-gray-700 dark:focus:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 rounded-sm transition-colors duration-200">
                            ì£¼ë¬¸ ê´€ë¦¬
                        </a>
                    </div>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right h-4 w-4 lg:h-5 lg:w-5 text-gray-400 dark:text-gray-500" aria-hidden="true"></i>
                        <span class="ml-2 lg:ml-4 text-xs lg:text-sm font-medium text-gray-500 dark:text-gray-400">{{ order.order_number }}</span>
                    </div>
                </li>
            </ol>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8">
        <div class="space-y-6 lg:space-y-8">
            <!-- Page Header -->
            <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300">
                <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 px-6 py-8">
                    <div class="flex flex-col space-y-4 lg:flex-row lg:items-center lg:justify-between lg:space-y-0">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center">
                                <i class="fas fa-shopping-cart text-white text-2xl"></i>
                            </div>
                            <div>
                                <h1 class="text-2xl lg:text-3xl font-bold text-white">ì£¼ë¬¸ ìƒì„¸</h1>
                                <p class="text-blue-100 font-medium">ì£¼ë¬¸ë²ˆí˜¸: {{ order.order_number }}</p>
                            </div>
                        </div>
                        <div class="flex flex-col space-y-3 lg:flex-row lg:items-center lg:space-y-0 lg:space-x-4">
                            <!-- Status Badge -->
                            <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold backdrop-blur-sm
                                {% if order.status == 'PENDING' %}bg-yellow-500/20 text-yellow-100 border border-yellow-300/30
                                {% elif order.status == 'PROCESSING' %}bg-blue-500/20 text-blue-100 border border-blue-300/30
                                {% elif order.status == 'SHIPPED' %}bg-purple-500/20 text-purple-100 border border-purple-300/30
                                {% elif order.status == 'DELIVERED' %}bg-green-500/20 text-green-100 border border-green-300/30
                                {% elif order.status == 'CANCELLED' %}bg-red-500/20 text-red-100 border border-red-300/30
                                {% else %}bg-gray-500/20 text-gray-100 border border-gray-300/30{% endif %}">
                                <i class="fas fa-circle w-2 h-2 mr-2"></i>
                                {{ order.get_status_display }}
                            </span>
                            
                            <!-- Action Buttons -->
                            <div class="flex space-x-2">
                                <button type="button" 
                                        @click="updateStatus()"
                                        class="inline-flex items-center px-4 py-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 hover:shadow-lg">
                                    <i class="fas fa-edit mr-2"></i>
                                    ìƒíƒœ ë³€ê²½
                                </button>
                                <a href="{% url 'orders:edit' order.pk %}" 
                                   class="inline-flex items-center px-4 py-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 rounded-lg text-white font-medium transition-all duration-200 hover:scale-105 hover:shadow-lg">
                                    <i class="fas fa-pencil-alt mr-2"></i>
                                    ìˆ˜ì •
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8">
                <!-- Main Content -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Order Items -->
                    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300">
                        <div class="px-6 py-5 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-box text-indigo-600 dark:text-indigo-400 mr-3"></i>
                                ì£¼ë¬¸ ìƒí’ˆ
                            </h3>
                        </div>
                        
                        <div class="overflow-hidden">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-900/50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">ìƒí’ˆ</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">ìˆ˜ëŸ‰</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">ë‹¨ê°€</th>
                                        <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">í•©ê³„</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                    {% for item in order.items.all %}
                                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-200">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="flex-shrink-0 h-12 w-12">
                                                    {% if item.product.image %}
                                                        <img class="h-12 w-12 rounded-lg object-cover shadow-sm" 
                                                             src="{{ item.product.image.url }}" 
                                                             alt="{{ item.product.name }}">
                                                    {% else %}
                                                        <div class="h-12 w-12 rounded-lg bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-600 dark:to-gray-700 flex items-center justify-center">
                                                            <i class="fas fa-image text-gray-400 dark:text-gray-500"></i>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                                <div class="ml-4">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-white">
                                                        {{ item.product.name }}
                                                    </div>
                                                    <div class="text-sm text-gray-500 dark:text-gray-400">
                                                        SKU: {{ item.product.sku }}
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200">
                                                {{ item.quantity }}ê°œ
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white font-medium">
                                            â‚©{{ item.unit_price|floatformat:0|intcomma }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900 dark:text-white">
                                            â‚©{{ item.total_price|floatformat:0|intcomma }}
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="4" class="px-6 py-12 text-center">
                                            <div class="flex flex-col items-center space-y-3">
                                                <i class="fas fa-box-open text-4xl text-gray-300 dark:text-gray-600"></i>
                                                <p class="text-gray-500 dark:text-gray-400">ì£¼ë¬¸ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Order Summary -->
                        <div class="bg-gray-50 dark:bg-gray-900/50 px-6 py-4 border-t border-gray-200 dark:border-gray-700">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-semibold text-gray-900 dark:text-white">ì´ ì£¼ë¬¸ ê¸ˆì•¡</span>
                                <span class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">â‚©{{ order.total_amount|floatformat:0|intcomma }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Order Timeline -->
                    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300">
                        <div class="px-6 py-5 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-clock text-green-600 dark:text-green-400 mr-3"></i>
                                ì£¼ë¬¸ ì§„í–‰ ìƒí™©
                            </h3>
                        </div>
                        
                        <div class="p-6">
                            <div class="flow-root">
                                <ul class="-mb-8">
                                    <!-- Order Created -->
                                    <li>
                                        <div class="relative pb-8">
                                            <div class="absolute top-5 left-5 -ml-px h-full w-0.5 bg-gray-200 dark:bg-gray-600" aria-hidden="true"></div>
                                            <div class="relative flex items-start space-x-3">
                                                <div>
                                                    <span class="h-10 w-10 rounded-full bg-green-500 flex items-center justify-center ring-4 ring-white dark:ring-gray-800 shadow-lg">
                                                        <i class="fas fa-plus h-4 w-4 text-white" aria-hidden="true"></i>
                                                    </span>
                                                </div>
                                                <div class="min-w-0 flex-1">
                                                    <div>
                                                        <p class="text-sm font-medium text-gray-900 dark:text-white">ì£¼ë¬¸ ìƒì„±</p>
                                                        <p class="text-sm text-gray-500 dark:text-gray-400">ìƒˆë¡œìš´ ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                                                    </div>
                                                    <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                                        <time datetime="{{ order.created_at|date:'c' }}">{{ order.created_at|date:'Yë…„ mì›” dì¼ H:i' }}</time>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>

                                    <!-- Processing Status -->
                                    {% if order.status != 'PENDING' %}
                                    <li>
                                        <div class="relative pb-8">
                                            <div class="absolute top-5 left-5 -ml-px h-full w-0.5 bg-gray-200 dark:bg-gray-600" aria-hidden="true"></div>
                                            <div class="relative flex items-start space-x-3">
                                                <div>
                                                    <span class="h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center ring-4 ring-white dark:ring-gray-800 shadow-lg">
                                                        <i class="fas fa-cog h-4 w-4 text-white" aria-hidden="true"></i>
                                                    </span>
                                                </div>
                                                <div class="min-w-0 flex-1">
                                                    <div>
                                                        <p class="text-sm font-medium text-gray-900 dark:text-white">ì²˜ë¦¬ ì‹œì‘</p>
                                                        <p class="text-sm text-gray-500 dark:text-gray-400">ì£¼ë¬¸ ì²˜ë¦¬ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                                                    </div>
                                                    <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                                        <time datetime="{{ order.updated_at|date:'c' }}">{{ order.updated_at|date:'Yë…„ mì›” dì¼ H:i' }}</time>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    {% endif %}

                                    <!-- Shipped Status -->
                                    {% if order.status == 'SHIPPED' or order.status == 'DELIVERED' %}
                                    <li>
                                        <div class="relative pb-8">
                                            {% if order.status != 'DELIVERED' %}<div class="absolute top-5 left-5 -ml-px h-full w-0.5 bg-gray-200 dark:bg-gray-600" aria-hidden="true"></div>{% endif %}
                                            <div class="relative flex items-start space-x-3">
                                                <div>
                                                    <span class="h-10 w-10 rounded-full bg-purple-500 flex items-center justify-center ring-4 ring-white dark:ring-gray-800 shadow-lg">
                                                        <i class="fas fa-truck h-4 w-4 text-white" aria-hidden="true"></i>
                                                    </span>
                                                </div>
                                                <div class="min-w-0 flex-1">
                                                    <div>
                                                        <p class="text-sm font-medium text-gray-900 dark:text-white">ë°°ì†¡ ì‹œì‘</p>
                                                        <p class="text-sm text-gray-500 dark:text-gray-400">ìƒí’ˆì´ ë°°ì†¡ ì¤‘ì…ë‹ˆë‹¤.</p>
                                                        {% if order.tracking_number %}
                                                        <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">ì¶”ì ë²ˆí˜¸: {{ order.tracking_number }}</p>
                                                        {% endif %}
                                                    </div>
                                                    <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                                        <time datetime="{{ order.shipped_date|date:'c' }}">{{ order.shipped_date|date:'Yë…„ mì›” dì¼ H:i' }}</time>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    {% endif %}

                                    <!-- Delivered Status -->
                                    {% if order.status == 'DELIVERED' %}
                                    <li>
                                        <div class="relative">
                                            <div class="relative flex items-start space-x-3">
                                                <div>
                                                    <span class="h-10 w-10 rounded-full bg-green-600 flex items-center justify-center ring-4 ring-white dark:ring-gray-800 shadow-lg">
                                                        <i class="fas fa-check h-4 w-4 text-white" aria-hidden="true"></i>
                                                    </span>
                                                </div>
                                                <div class="min-w-0 flex-1">
                                                    <div>
                                                        <p class="text-sm font-medium text-gray-900 dark:text-white">ë°°ì†¡ ì™„ë£Œ</p>
                                                        <p class="text-sm text-gray-500 dark:text-gray-400">ìƒí’ˆì´ ì„±ê³µì ìœ¼ë¡œ ë°°ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                                                    </div>
                                                    <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                                        <time datetime="{{ order.delivered_date|date:'c' }}">{{ order.delivered_date|date:'Yë…„ mì›” dì¼ H:i' }}</time>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    {% endif %}

                                    <!-- Cancelled Status -->
                                    {% if order.status == 'CANCELLED' %}
                                    <li>
                                        <div class="relative">
                                            <div class="relative flex items-start space-x-3">
                                                <div>
                                                    <span class="h-10 w-10 rounded-full bg-red-500 flex items-center justify-center ring-4 ring-white dark:ring-gray-800 shadow-lg">
                                                        <i class="fas fa-times h-4 w-4 text-white" aria-hidden="true"></i>
                                                    </span>
                                                </div>
                                                <div class="min-w-0 flex-1">
                                                    <div>
                                                        <p class="text-sm font-medium text-gray-900 dark:text-white">ì£¼ë¬¸ ì·¨ì†Œ</p>
                                                        <p class="text-sm text-gray-500 dark:text-gray-400">ì£¼ë¬¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                                                    </div>
                                                    <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                                                        <time datetime="{{ order.cancelled_date|date:'c' }}">{{ order.cancelled_date|date:'Yë…„ mì›” dì¼ H:i' }}</time>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Customer Information -->
                    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300">
                        <div class="px-6 py-5 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-user text-blue-600 dark:text-blue-400 mr-3"></i>
                                ê³ ê° ì •ë³´
                            </h3>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                                    <span class="text-white font-bold text-sm">{{ order.customer_name|first|upper }}</span>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900 dark:text-white">{{ order.customer_name }}</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">ê³ ê°</p>
                                </div>
                            </div>
                            
                            {% if order.customer_email %}
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                                <i class="fas fa-envelope text-gray-400 dark:text-gray-500"></i>
                                <a href="mailto:{{ order.customer_email }}" 
                                   class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-200">
                                    {{ order.customer_email }}
                                </a>
                            </div>
                            {% endif %}
                            
                            {% if order.customer_phone %}
                            <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                                <i class="fas fa-phone text-gray-400 dark:text-gray-500"></i>
                                <a href="tel:{{ order.customer_phone }}" 
                                   class="text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-200">
                                    {{ order.customer_phone }}
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Shipping Information -->
                    {% if order.shipping_address %}
                    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300">
                        <div class="px-6 py-5 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-map-marker-alt text-green-600 dark:text-green-400 mr-3"></i>
                                ë°°ì†¡ ì •ë³´
                            </h3>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            <div class="space-y-2">
                                <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">ë°°ì†¡ì§€ ì£¼ì†Œ</dt>
                                <dd class="text-sm text-gray-900 dark:text-white leading-relaxed">
                                    {{ order.shipping_address }}
                                </dd>
                            </div>
                            
                            {% if order.shipping_zipcode %}
                            <div class="space-y-2">
                                <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">ìš°í¸ë²ˆí˜¸</dt>
                                <dd class="text-sm text-gray-900 dark:text-white">{{ order.shipping_zipcode }}</dd>
                            </div>
                            {% endif %}
                            
                            {% if order.shipping_method %}
                            <div class="space-y-2">
                                <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">ë°°ì†¡ ë°©ë²•</dt>
                                <dd class="text-sm text-gray-900 dark:text-white">{{ order.get_shipping_method_display }}</dd>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Order Information -->
                    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300">
                        <div class="px-6 py-5 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-info-circle text-purple-600 dark:text-purple-400 mr-3"></i>
                                ì£¼ë¬¸ ì •ë³´
                            </h3>
                        </div>
                        
                        <div class="p-6 space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <dt class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">ì£¼ë¬¸ì¼ì‹œ</dt>
                                    <dd class="text-sm text-gray-900 dark:text-white mt-1">{{ order.created_at|date:'Y-m-d' }}</dd>
                                </div>
                                <div>
                                    <dt class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">í”Œë«í¼</dt>
                                    <dd class="text-sm text-gray-900 dark:text-white mt-1">{{ order.platform.name|default:'ì§ì ‘ ì£¼ë¬¸' }}</dd>
                                </div>
                            </div>
                            
                            {% if order.notes %}
                            <div class="space-y-2">
                                <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">ì£¼ë¬¸ ë©”ëª¨</dt>
                                <dd class="text-sm text-gray-900 dark:text-white leading-relaxed p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                                    {{ order.notes }}
                                </dd>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden transition-all duration-300">
                        <div class="px-6 py-5 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                                <i class="fas fa-bolt text-yellow-600 dark:text-yellow-400 mr-3"></i>
                                ë¹ ë¥¸ ì‘ì—…
                            </h3>
                        </div>
                        
                        <div class="p-6 space-y-3">
                            <button type="button" 
                                    @click="printOrder()"
                                    class="w-full flex items-center justify-center px-4 py-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-md">
                                <i class="fas fa-print mr-2"></i>
                                ì£¼ë¬¸ì„œ ì¸ì‡„
                            </button>
                            
                            <button type="button" 
                                    @click="showEmailModal = true"
                                    :disabled="!hasCustomerEmail"
                                    class="w-full flex items-center justify-center px-4 py-3 bg-blue-100 dark:bg-blue-900/30 hover:bg-blue-200 dark:hover:bg-blue-900/50 text-blue-700 dark:text-blue-300 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100">
                                <i class="fas fa-envelope mr-2"></i>
                                ì´ë©”ì¼ ë°œì†¡
                            </button>
                            
                            {% if order.status == 'SHIPPED' and order.tracking_number %}
                            <button type="button" 
                                    @click="trackPackage()"
                                    class="w-full flex items-center justify-center px-4 py-3 bg-green-100 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50 text-green-700 dark:text-green-300 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-md">
                                <i class="fas fa-truck mr-2"></i>
                                ë°°ì†¡ ì¶”ì 
                            </button>
                            {% endif %}
                            
                            {% if order.status != 'CANCELLED' and order.status != 'DELIVERED' %}
                            <button type="button" 
                                    @click="cancelOrder()"
                                    class="w-full flex items-center justify-center px-4 py-3 bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 text-red-700 dark:text-red-300 rounded-lg transition-all duration-200 hover:scale-105 hover:shadow-md">
                                <i class="fas fa-times mr-2"></i>
                                ì£¼ë¬¸ ì·¨ì†Œ
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¸ì‡„ìš© ìˆ¨ê²¨ì§„ ì˜ì—­ -->
    <div class="print-area" style="display: none;">
        <div class="print-company-info">
            <h1>ğŸ“¦ Shopuda ERP</h1>
            <p>ì˜¨ë¼ì¸ ì‡¼í•‘ëª° í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            <p>ì£¼ì†Œ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123</p>
            <p>ì „í™”: 02-1234-5678 | ì´ë©”ì¼: info@shopuda.com</p>
        </div>
        
        <div class="print-header">
            <h2>ğŸ“‹ ì£¼ë¬¸ì„œ</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                <div>
                    <strong>ì£¼ë¬¸ë²ˆí˜¸:</strong> {{ order.order_number }}<br>
                    <strong>ì£¼ë¬¸ì¼ì‹œ:</strong> {{ order.created_at|date:"Yë…„ mì›” dì¼ H:i" }}<br>
                    <strong>ì£¼ë¬¸ìƒíƒœ:</strong> {{ order.get_status_display }}
                </div>
                <div>
                    {% if order.platform %}
                    <strong>í”Œë«í¼:</strong> {{ order.platform.name }}<br>
                    {% endif %}
                    {% if order.tracking_number %}
                    <strong>ìš´ì†¡ì¥ë²ˆí˜¸:</strong> {{ order.tracking_number }}<br>
                    {% endif %}
                    <strong>ì¸ì‡„ì¼ì‹œ:</strong> <span id="print-date"></span>
                </div>
            </div>
        </div>
        
        <div class="print-customer-info">
            <h3>ğŸ‘¤ ê³ ê° ì •ë³´</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <strong>ê³ ê°ëª…:</strong> {{ order.customer_name }}<br>
                    {% if order.customer_email %}
                    <strong>ì´ë©”ì¼:</strong> {{ order.customer_email }}<br>
                    {% endif %}
                    {% if order.customer_phone %}
                    <strong>ì „í™”ë²ˆí˜¸:</strong> {{ order.customer_phone }}
                    {% endif %}
                </div>
                <div>
                    {% if order.shipping_address %}
                    <strong>ë°°ì†¡ì§€ ì£¼ì†Œ:</strong><br>
                    {{ order.shipping_address }}<br>
                    {% if order.shipping_zipcode %}
                    ìš°í¸ë²ˆí˜¸: {{ order.shipping_zipcode }}
                    {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
        
        <table class="print-table">
            <thead>
                <tr>
                    <th>ìƒí’ˆëª…</th>
                    <th>SKU</th>
                    <th>ìˆ˜ëŸ‰</th>
                    <th>ë‹¨ê°€</th>
                    <th>í•©ê³„</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items.all %}
                <tr>
                    <td>{{ item.product.name }}</td>
                    <td>{{ item.product.sku }}</td>
                    <td>{{ item.quantity }}ê°œ</td>
                    <td>â‚©{{ item.unit_price|floatformat:0|intcomma }}</td>
                    <td>â‚©{{ item.total_price|floatformat:0|intcomma }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div class="print-total">
            ì´ ì£¼ë¬¸ ê¸ˆì•¡: â‚©{{ order.total_amount|floatformat:0|intcomma }}
        </div>
        
        <!-- ì£¼ë¬¸ ì§„í–‰ ìƒí™© (ì¸ì‡„ìš©) -->
        <div class="print-timeline">
            <h3>ğŸ“ˆ ì£¼ë¬¸ ì§„í–‰ ìƒí™©</h3>
            <ul>
                <li>âœ… ì£¼ë¬¸ ìƒì„±: {{ order.created_at|date:"Yë…„ mì›” dì¼ H:i" }}</li>
                {% if order.status != 'PENDING' %}
                <li>ğŸ”„ ì²˜ë¦¬ ì‹œì‘: {{ order.updated_at|date:"Yë…„ mì›” dì¼ H:i" }}</li>
                {% endif %}
                {% if order.status == 'SHIPPED' or order.status == 'DELIVERED' %}
                <li>ğŸšš ë°°ì†¡ ì‹œì‘: {{ order.shipped_date|date:"Yë…„ mì›” dì¼ H:i" }}
                    {% if order.tracking_number %} (ì¶”ì ë²ˆí˜¸: {{ order.tracking_number }}){% endif %}
                </li>
                {% endif %}
                {% if order.status == 'DELIVERED' %}
                <li>ğŸ“¦ ë°°ì†¡ ì™„ë£Œ: {{ order.delivered_date|date:"Yë…„ mì›” dì¼ H:i" }}</li>
                {% endif %}
                {% if order.status == 'CANCELLED' %}
                <li>âŒ ì£¼ë¬¸ ì·¨ì†Œ: {{ order.cancelled_date|date:"Yë…„ mì›” dì¼ H:i" }}</li>
                {% endif %}
            </ul>
        </div>
        
        {% if order.notes %}
        <div style="margin-top: 30px;">
            <h4>ğŸ“ ì£¼ë¬¸ ë©”ëª¨</h4>
            <p style="border: 1px solid #ccc; padding: 10px; background: #f9f9f9;">{{ order.notes }}</p>
        </div>
        {% endif %}
        
        <div class="print-footer">
            <p>ë³¸ ì£¼ë¬¸ì„œëŠ” Shopuda ERP ì‹œìŠ¤í…œì—ì„œ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <p>ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ê³ ê°ì„¼í„°(02-1234-5678)ë¡œ ì—°ë½ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>
            <p style="margin-top: 10px;">Â© 2024 Shopuda. All rights reserved.</p>
        </div>
    </div>

    <!-- Status Update Modal -->
    <div x-show="showStatusModal" x-cloak 
         class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" 
                 @click="showStatusModal = false"></div>
            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-2xl px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div class="sm:flex sm:items-start">
                    <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-900/30 sm:mx-0 sm:h-10 sm:w-10">
                        <i class="fas fa-edit text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">
                            ì£¼ë¬¸ ìƒíƒœ ë³€ê²½
                        </h3>
                        <div class="mt-4">
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ìƒˆë¡œìš´ ìƒíƒœ</label>
                                    <select x-model="newStatus" 
                                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors duration-200">
                                        <option value="PENDING">ëŒ€ê¸°</option>
                                        <option value="PROCESSING">ì²˜ë¦¬ì¤‘</option>
                                        <option value="SHIPPED">ë°°ì†¡ì¤‘</option>
                                        <option value="DELIVERED">ë°°ì†¡ì™„ë£Œ</option>
                                        <option value="CANCELLED">ì·¨ì†Œ</option>
                                    </select>
                                </div>
                                
                                <div x-show="newStatus === 'SHIPPED'">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì¶”ì ë²ˆí˜¸ (ì„ íƒì‚¬í•­)</label>
                                    <input type="text" x-model="trackingNumber" 
                                           placeholder="ì¶”ì ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                                           class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors duration-200">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
                    <button type="button" 
                            @click="confirmStatusUpdate()"
                            class="w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 bg-blue-600 hover:bg-blue-700 text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm transition-all duration-200 hover:scale-105">
                        ë³€ê²½í•˜ê¸°
                    </button>
                    <button type="button" 
                            @click="showStatusModal = false"
                            class="mt-3 w-full inline-flex justify-center rounded-lg border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm transition-all duration-200">
                        ì·¨ì†Œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Email Modal -->
    <div x-show="showEmailModal" x-cloak 
         class="fixed inset-0 z-50 overflow-y-auto"
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity" 
                 @click="showEmailModal = false"></div>

            <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-2xl px-6 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full sm:p-6 email-modal"
                 x-transition:enter="ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                 x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave="ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
                 x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95">
                
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-envelope text-blue-600 dark:text-blue-400"></i>
                        </div>
                        <h3 class="text-lg leading-6 font-semibold text-gray-900 dark:text-white">
                            ğŸ“§ ì´ë©”ì¼ ë°œì†¡
                        </h3>
                    </div>
                    <button @click="showEmailModal = false" 
                            class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 text-xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-6">
                    <!-- ìˆ˜ì‹ ì ì •ë³´ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ğŸ“¤ ìˆ˜ì‹ ì</label>
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                            <i class="fas fa-user text-gray-400"></i>
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">{{ order.customer_name }}</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{{ order.customer_email|default:"ì´ë©”ì¼ ì—†ìŒ" }}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì´ë©”ì¼ í…œí”Œë¦¿ ì„ íƒ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">ğŸ“‹ ì´ë©”ì¼ í…œí”Œë¦¿</label>
                        <div class="email-template-selector">
                            <div class="template-option" 
                                 :class="{ 'selected': emailTemplate === 'order_confirmation' }"
                                 @click="selectEmailTemplate('order_confirmation')">
                                <i class="fas fa-check-circle text-green-500 mb-2 text-xl"></i>
                                <h4 class="font-medium">âœ… ì£¼ë¬¸ í™•ì¸</h4>
                                <p class="text-xs text-gray-500">ì£¼ë¬¸ ì ‘ìˆ˜ í™•ì¸ ë©”ì¼</p>
                            </div>
                            
                            <div class="template-option" 
                                 :class="{ 'selected': emailTemplate === 'shipping_notification' }"
                                 @click="selectEmailTemplate('shipping_notification')">
                                <i class="fas fa-truck text-blue-500 mb-2 text-xl"></i>
                                <h4 class="font-medium">ğŸšš ë°°ì†¡ ì•ˆë‚´</h4>
                                <p class="text-xs text-gray-500">ë°°ì†¡ ì‹œì‘ ì•Œë¦¼ ë©”ì¼</p>
                            </div>
                            
                            <div class="template-option" 
                                 :class="{ 'selected': emailTemplate === 'delivery_complete' }"
                                 @click="selectEmailTemplate('delivery_complete')">
                                <i class="fas fa-gift text-purple-500 mb-2 text-xl"></i>
                                <h4 class="font-medium">ğŸ“¦ ë°°ì†¡ ì™„ë£Œ</h4>
                                <p class="text-xs text-gray-500">ë°°ì†¡ ì™„ë£Œ ì•Œë¦¼ ë©”ì¼</p>
                            </div>
                            
                            <div class="template-option" 
                                 :class="{ 'selected': emailTemplate === 'custom' }"
                                 @click="selectEmailTemplate('custom')">
                                <i class="fas fa-edit text-orange-500 mb-2 text-xl"></i>
                                <h4 class="font-medium">âœï¸ ì‚¬ìš©ì ì •ì˜</h4>
                                <p class="text-xs text-gray-500">ì§ì ‘ ì‘ì„±í•˜ê¸°</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì´ë©”ì¼ ì œëª© -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ğŸ“ ì œëª©</label>
                        <input type="text" 
                               x-model="emailSubject" 
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors duration-200"
                               placeholder="ì´ë©”ì¼ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    
                    <!-- ì´ë©”ì¼ ë‚´ìš© -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ğŸ“„ ë‚´ìš©</label>
                        <textarea x-model="emailContent" 
                                  rows="8"
                                  class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-colors duration-200 resize-none"
                                  placeholder="ì´ë©”ì¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    
                    <!-- ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° -->
                    <div x-show="emailTemplate !== 'custom'" class="email-preview">
                        <h4 class="font-medium text-gray-900 dark:text-white mb-3">ğŸ‘€ ë¯¸ë¦¬ë³´ê¸°</h4>
                        <div class="prose dark:prose-invert max-w-none">
                            <div x-html="getEmailPreview()"></div>
                        </div>
                    </div>
                    
                    <!-- ì¶”ê°€ ì˜µì…˜ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <label class="flex items-center">
                            <input type="checkbox" x-model="includeOrderDetails" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">ğŸ“‹ ì£¼ë¬¸ ìƒì„¸ ì •ë³´ í¬í•¨</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" x-model="sendCopyToAdmin" 
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">ğŸ‘¨â€ğŸ’¼ ê´€ë¦¬ìì—ê²Œ ì‚¬ë³¸ ë°œì†¡</span>
                        </label>
                    </div>
                </div>
                
                <!-- ëª¨ë‹¬ ì•¡ì…˜ ë²„íŠ¼ -->
                <div class="mt-6 flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3">
                    <button type="button" 
                            @click="showEmailModal = false"
                            class="w-full sm:w-auto px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                        âŒ ì·¨ì†Œ
                    </button>
                    
                    <button type="button" 
                            @click="previewEmail()"
                            class="w-full sm:w-auto px-4 py-2 border border-blue-300 rounded-lg shadow-sm bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200">
                        <i class="fas fa-eye mr-2"></i>
                        ğŸ‘€ ë¯¸ë¦¬ë³´ê¸°
                    </button>
                    
                    <button type="button" 
                            @click="sendEmail()"
                            :disabled="!emailSubject || !emailContent || sendingEmail || !hasCustomerEmail"
                            class="w-full sm:w-auto px-4 py-2 border border-transparent rounded-lg shadow-sm bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 disabled:cursor-not-allowed">
                        <span x-show="!sendingEmail" class="flex items-center justify-center">
                            <i class="fas fa-paper-plane mr-2"></i>
                            ğŸ“§ ì´ë©”ì¼ ë°œì†¡
                        </span>
                        <span x-show="sendingEmail" x-cloak class="flex items-center justify-center">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            ğŸ“¤ ë°œì†¡ ì¤‘...
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function orderDetail() {
    return {
        showStatusModal: false,
        showEmailModal: false,
        newStatus: '{{ order.status }}',
        trackingNumber: '{{ order.tracking_number|default:"" }}',
        
        // ì´ë©”ì¼ ê´€ë ¨ ë°ì´í„°
        emailTemplate: 'order_confirmation',
        emailSubject: '',
        emailContent: '',
        includeOrderDetails: true,
        sendCopyToAdmin: false,
        sendingEmail: false,
        hasCustomerEmail: {{ order.customer_email|yesno:"true,false" }},
        
        // ì´ë©”ì¼ í…œí”Œë¦¿ ë°ì´í„°
        emailTemplates: {
            order_confirmation: {
                subject: '[Shopuda] ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤ - {{ order.order_number }}',
                content: `ì•ˆë…•í•˜ì„¸ìš”, {{ order.customer_name }}ë‹˜! ğŸ‘‹

Shopudaì—ì„œ ì£¼ë¬¸í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìœ¼ë©°, í˜„ì¬ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.

ğŸ“‹ ì£¼ë¬¸ ì •ë³´
â€¢ ì£¼ë¬¸ë²ˆí˜¸: {{ order.order_number }}
â€¢ ì£¼ë¬¸ì¼ì‹œ: {{ order.created_at|date:"Yë…„ mì›” dì¼ H:i" }}
â€¢ ì£¼ë¬¸ìƒíƒœ: {{ order.get_status_display }}

ğŸ’° ê²°ì œ ê¸ˆì•¡
ì´ ì£¼ë¬¸ ê¸ˆì•¡: â‚©{{ order.total_amount|floatformat:0|intcomma }}

ğŸ“¦ ë°°ì†¡ ì •ë³´
{% if order.shipping_address %}ë°°ì†¡ì§€: {{ order.shipping_address }}{% endif %}
{% if order.shipping_method %}ë°°ì†¡ ë°©ë²•: {{ order.get_shipping_method_display }}{% endif %}

ì£¼ë¬¸ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ë©´ ë°°ì†¡ ì•ˆë‚´ ë©”ì¼ì„ ë³„ë„ë¡œ ë°œì†¡í•´ ë“œë¦½ë‹ˆë‹¤.

ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì—°ë½ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤.
Shopuda ê³ ê°ì„¼í„° ğŸ“`
            },
            shipping_notification: {
                subject: '[Shopuda] ìƒí’ˆì´ ë°°ì†¡ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤ - {{ order.order_number }}',
                content: `ì•ˆë…•í•˜ì„¸ìš”, {{ order.customer_name }}ë‹˜! ğŸšš

ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì˜ ë°°ì†¡ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“‹ ì£¼ë¬¸ ì •ë³´
â€¢ ì£¼ë¬¸ë²ˆí˜¸: {{ order.order_number }}
â€¢ ì£¼ë¬¸ì¼ì‹œ: {{ order.created_at|date:"Yë…„ mì›” dì¼ H:i" }}

ğŸšš ë°°ì†¡ ì •ë³´
{% if order.tracking_number %}â€¢ ìš´ì†¡ì¥ ë²ˆí˜¸: {{ order.tracking_number }}{% endif %}
{% if order.shipping_address %}â€¢ ë°°ì†¡ì§€: {{ order.shipping_address }}{% endif %}
â€¢ ì˜ˆìƒ ë°°ì†¡ì¼: 2-3ì¼ ë‚´

{% if order.tracking_number %}ìš´ì†¡ì¥ ë²ˆí˜¸ë¡œ ë°°ì†¡ ìƒí™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.{% endif %}

ì•ˆì „í•˜ê²Œ í¬ì¥í•˜ì—¬ ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ë°°ì†¡í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.
Shopuda ê³ ê°ì„¼í„° ğŸ“¦`
            },
            delivery_complete: {
                subject: '[Shopuda] ë°°ì†¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤ - {{ order.order_number }}',
                content: `ì•ˆë…•í•˜ì„¸ìš”, {{ order.customer_name }}ë‹˜! ğŸ“¦

ì£¼ë¬¸í•˜ì‹  ìƒí’ˆì´ ì„±ê³µì ìœ¼ë¡œ ë°°ì†¡ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“‹ ì£¼ë¬¸ ì •ë³´
â€¢ ì£¼ë¬¸ë²ˆí˜¸: {{ order.order_number }}
â€¢ ë°°ì†¡ì™„ë£Œì¼: {{ order.delivered_date|date:"Yë…„ mì›” dì¼ H:i" }}

ğŸ ìƒí’ˆì„ ë°›ìœ¼ì…¨ë‹¤ë©´
ìƒí’ˆì— ë¬¸ì œê°€ ìˆê±°ë‚˜ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ê³ ê°ì„¼í„°ë¡œ ì—°ë½ì£¼ì„¸ìš”.

ğŸ“ ë¦¬ë·° ì‘ì„±
ë§Œì¡±í•˜ì…¨ë‹¤ë©´ ìƒí’ˆ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì‹œë©´ ë‹¤ë¥¸ ê³ ê°ë“¤ì—ê²Œ í° ë„ì›€ì´ ë©ë‹ˆë‹¤.

ì•ìœ¼ë¡œë„ Shopudaë¥¼ ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.
Shopuda ê³ ê°ì„¼í„° â­`
            }
        },
        
        init() {
            this.selectEmailTemplate('order_confirmation');
        },
        
        selectEmailTemplate(template) {
            this.emailTemplate = template;
            if (template !== 'custom' && this.emailTemplates[template]) {
                this.emailSubject = this.emailTemplates[template].subject;
                this.emailContent = this.emailTemplates[template].content;
            } else if (template === 'custom') {
                this.emailSubject = '';
                this.emailContent = '';
            }
        },
        
        getEmailPreview() {
            return this.emailContent.replace(/\n/g, '<br>');
        },
        
        async sendEmail() {
            if (!this.emailSubject || !this.emailContent) {
                this.showAlert('error', 'ì…ë ¥ ì˜¤ë¥˜', 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!this.hasCustomerEmail) {
                this.showAlert('error', 'ì´ë©”ì¼ ì˜¤ë¥˜', 'ê³ ê° ì´ë©”ì¼ ì£¼ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            this.sendingEmail = true;
            
            try {
                const emailData = {
                    recipient_email: '{{ order.customer_email }}',
                    recipient_name: '{{ order.customer_name }}',
                    subject: this.emailSubject,
                    content: this.emailContent,
                    template: this.emailTemplate,
                    include_order_details: this.includeOrderDetails,
                    send_copy_to_admin: this.sendCopyToAdmin,
                    order_id: {{ order.pk }}
                };
                
                const response = await fetch(`{% url 'orders:send_email' order.pk %}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCsrfToken(),
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(emailData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    this.showAlert('success', 'ë°œì†¡ ì™„ë£Œ', 'ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    this.showEmailModal = false;
                } else {
                    this.showAlert('error', 'ë°œì†¡ ì‹¤íŒ¨', data.message || 'ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Email send error:', error);
                this.showAlert('error', 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜', 'ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                this.sendingEmail = false;
            }
        },
        
        previewEmail() {
            // ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ìƒˆ ì°½ì—ì„œ ì—´ê¸°
            const previewWindow = window.open('', '_blank', 'width=700,height=900,scrollbars=yes');
            const orderDetails = this.includeOrderDetails ? this.generateOrderDetailsHtml() : '';
            
            previewWindow.document.write(`
                <html>
                    <head>
                        <title>ğŸ“§ ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸°</title>
                        <style>
                            body { 
                                font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif; 
                                line-height: 1.6; 
                                margin: 0; 
                                padding: 20px;
                                background: #f9fafb;
                                color: #374151;
                            }
                            .email-container {
                                max-width: 600px;
                                margin: 0 auto;
                                background: white;
                                padding: 30px;
                                border-radius: 12px;
                                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                            }
                            .header {
                                text-align: center;
                                border-bottom: 3px solid #3b82f6;
                                padding-bottom: 20px;
                                margin-bottom: 30px;
                            }
                            .logo {
                                font-size: 28px;
                                font-weight: bold;
                                color: #3b82f6;
                                margin-bottom: 10px;
                            }
                            .content {
                                white-space: pre-line;
                                margin-bottom: 30px;
                            }
                            .footer {
                                margin-top: 30px;
                                padding-top: 20px;
                                border-top: 2px solid #e5e7eb;
                                font-size: 14px;
                                color: #6b7280;
                                text-align: center;
                            }
                            .order-details {
                                background: #f8fafc;
                                padding: 20px;
                                border-radius: 8px;
                                margin: 20px 0;
                                border-left: 4px solid #3b82f6;
                            }
                            .order-table {
                                width: 100%;
                                border-collapse: collapse;
                                margin-top: 15px;
                            }
                            .order-table th, .order-table td {
                                padding: 8px 12px;
                                text-align: left;
                                border-bottom: 1px solid #e5e7eb;
                            }
                            .order-table th {
                                background: #f1f5f9;
                                font-weight: 600;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="email-container">
                            <div class="header">
                                <div class="logo">ğŸ“¦ Shopuda</div>
                                <div>ì˜¨ë¼ì¸ ì‡¼í•‘ëª° í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
                            </div>
                            
                            <h2>${this.emailSubject}</h2>
                            
                            <div class="content">${this.emailContent}</div>
                            
                            ${orderDetails}
                            
                            <div class="footer">
                                <p>ë³¸ ë©”ì¼ì€ Shopuda ERP ì‹œìŠ¤í…œì—ì„œ ìë™ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                                <p>
                                    ğŸ“ ë¬¸ì˜: 02-1234-5678 | 
                                    ğŸ“§ ì´ë©”ì¼: support@shopuda.com
                                </p>
                                <p style="margin-top: 15px; font-size: 12px; color: #9ca3af;">
                                    Â© 2024 Shopuda. All rights reserved.
                                </p>
                            </div>
                        </div>
                    </body>
                </html>
            `);
            previewWindow.document.close();
        },
        
        generateOrderDetailsHtml() {
            return `
            <div class="order-details">
                <h3>ğŸ“‹ ì£¼ë¬¸ ìƒì„¸ ì •ë³´</h3>
                <p><strong>ì£¼ë¬¸ë²ˆí˜¸:</strong> {{ order.order_number }}</p>
                <p><strong>ì£¼ë¬¸ì¼ì‹œ:</strong> {{ order.created_at|date:"Yë…„ mì›” dì¼ H:i" }}</p>
                <p><strong>ì£¼ë¬¸ìƒíƒœ:</strong> {{ order.get_status_display }}</p>
                
                <table class="order-table">
                    <thead>
                        <tr>
                            <th>ìƒí’ˆëª…</th>
                            <th>ìˆ˜ëŸ‰</th>
                            <th>ë‹¨ê°€</th>
                            <th>í•©ê³„</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.items.all %}
                        <tr>
                            <td>{{ item.product.name }}</td>
                            <td>{{ item.quantity }}ê°œ</td>
                            <td>â‚©{{ item.unit_price|floatformat:0|intcomma }}</td>
                            <td>â‚©{{ item.total_price|floatformat:0|intcomma }}</td>
                        </tr>
                        {% endfor %}
                        <tr style="background: #f1f5f9; font-weight: bold;">
                            <td colspan="3">ì´ ì£¼ë¬¸ ê¸ˆì•¡:</td>
                            <td>â‚©{{ order.total_amount|floatformat:0|intcomma }}</td>
                        </tr>
                    </tbody>
                </table>
                
                {% if order.shipping_address %}
                <p style="margin-top: 15px;"><strong>ğŸšš ë°°ì†¡ì§€:</strong> {{ order.shipping_address }}</p>
                {% endif %}
                {% if order.tracking_number %}
                <p><strong>ğŸ“¦ ìš´ì†¡ì¥ ë²ˆí˜¸:</strong> {{ order.tracking_number }}</p>
                {% endif %}
            </div>
            `;
        },
        
        updateStatus() {
            this.showStatusModal = true;
        },
        
        async confirmStatusUpdate() {
            try {
                this.showLoading('ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ì¤‘...');
                
                const response = await fetch(`{% url 'orders:status_update' order.pk %}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': this.getCsrfToken(),
                    },
                    body: JSON.stringify({
                        status: this.newStatus.toLowerCase(),
                        tracking_number: this.trackingNumber
                    })
                });
                
                const data = await response.json();
                this.hideLoading();
                
                if (data.success) {
                    this.showAlert('success', 'ë³€ê²½ ì™„ë£Œ', data.message);
                    this.showStatusModal = false;
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    this.showAlert('error', 'ë³€ê²½ ì‹¤íŒ¨', data.message || 'ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                this.hideLoading();
                this.showAlert('error', 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜', 'ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error('Status update error:', error);
            }
        },
        
        printOrder() {
            // ì¸ì‡„ ë‚ ì§œ ì„¤ì •
            document.getElementById('print-date').textContent = new Date().toLocaleString('ko-KR');
            
            // ì¸ì‡„ìš© ìŠ¤íƒ€ì¼ ì ìš©
            const printArea = document.querySelector('.print-area');
            printArea.style.display = 'block';
            
            // ë¸Œë¼ìš°ì € ì¸ì‡„ ëŒ€í™”ìƒì ì—´ê¸°
            setTimeout(() => {
                window.print();
                // ì¸ì‡„ í›„ ë‹¤ì‹œ ìˆ¨ê¹€
                setTimeout(() => {
                    printArea.style.display = 'none';
                }, 1000);
            }, 100);
        },
        
        trackPackage() {
            if ('{{ order.tracking_number }}') {
                // ì‹¤ì œ íƒë°°ì‚¬ ì¶”ì  í˜ì´ì§€ë¡œ ì´ë™ (CJëŒ€í•œí†µìš´ ì˜ˆì‹œ)
                const trackingUrl = `https://www.doortodoor.co.kr/parcel/doortodoor.do?fsp_action=PARC_ACT_002&fsp_cmd=retrieveInvNoACT&invc_no={{ order.tracking_number }}`;
                window.open(trackingUrl, '_blank');
            } else {
                this.showAlert('warning', 'ì¶”ì  ë¶ˆê°€', 'ìš´ì†¡ì¥ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        },
        
        async cancelOrder() {
            const result = await this.showConfirm(
                'ì£¼ë¬¸ ì·¨ì†Œ', 
                'ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                'warning'
            );
            
            if (result.isConfirmed) {
                try {
                    this.showLoading('ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ëŠ” ì¤‘...');
                    
                    const response = await fetch(`{% url 'orders:status_update' order.pk %}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': this.getCsrfToken(),
                        },
                        body: JSON.stringify({
                            status: 'cancelled'
                        })
                    });
                    
                    const data = await response.json();
                    this.hideLoading();
                    
                    if (data.success) {
                        this.showAlert('success', 'ì·¨ì†Œ ì™„ë£Œ', 'ì£¼ë¬¸ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } else {
                        this.showAlert('error', 'ì·¨ì†Œ ì‹¤íŒ¨', data.message || 'ì£¼ë¬¸ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    this.hideLoading();
                    this.showAlert('error', 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜', 'ì£¼ë¬¸ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    console.error('Cancel order error:', error);
                }
            }
        },
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        getCsrfToken() {
            const token = document.querySelector('[name=csrfmiddlewaretoken]');
            if (token) {
                return token.value;
            }
            
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                const [name, value] = cookie.trim().split('=');
                if (name === 'csrftoken') {
                    return decodeURIComponent(value);
                }
            }
            
            const metaToken = document.querySelector('meta[name="csrf-token"]');
            if (metaToken) {
                return metaToken.getAttribute('content');
            }
            
            return '';
        },
        
        showLoading(message = 'ì²˜ë¦¬ ì¤‘...') {
            if (typeof Swal !== 'undefined') {
                Swal.fire({
                    title: message,
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    showConfirmButton: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
            }
        },
        
        hideLoading() {
            if (typeof Swal !== 'undefined') {
                Swal.close();
            }
        },
        
        showAlert(icon, title, message) {
            if (typeof Swal !== 'undefined') {
                Swal.fire({
                    icon: icon,
                    title: title,
                    text: message,
                    confirmButtonColor: icon === 'success' ? '#059669' : icon === 'error' ? '#dc2626' : '#d97706',
                    timer: icon === 'success' ? 3000 : undefined,
                    timerProgressBar: icon === 'success',
                    showConfirmButton: icon !== 'success'
                });
            } else {
                alert(`${title}: ${message}`);
            }
        },
        
        showConfirm(title, text, icon = 'question') {
            if (typeof Swal !== 'undefined') {
                return Swal.fire({
                    title: title,
                    text: text,
                    icon: icon,
                    showCancelButton: true,
                    confirmButtonColor: icon === 'warning' ? '#ef4444' : '#3b82f6',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: 'í™•ì¸',
                    cancelButtonText: 'ì·¨ì†Œ',
                    reverseButtons: true
                });
            } else {
                return { isConfirmed: confirm(`${title}\n${text}`) };
            }
        }
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì• ë‹ˆë©”ì´ì…˜
document.addEventListener('DOMContentLoaded', function() {
    // ì¹´ë“œë“¤ì— ìˆœì°¨ì ìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜ ì ìš©
    const cards = document.querySelectorAll('.bg-white, .dark\\:bg-gray-800');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('animate-fade-in');
    });
    
    // í…Œì´ë¸” í–‰ë“¤ì— ì• ë‹ˆë©”ì´ì…˜ ì ìš©
    const tableRows = document.querySelectorAll('tbody tr');
    tableRows.forEach((row, index) => {
        row.style.animationDelay = `${0.5 + index * 0.05}s`;
        row.classList.add('animate-fade-in');
    });
});

// í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
document.addEventListener('keydown', function(e) {
    // ESC: ëª¨ë‹¬ ë‹«ê¸°
    if (e.key === 'Escape') {
        const orderDetailComponent = document.querySelector('[x-data*="orderDetail"]');
        if (orderDetailComponent && orderDetailComponent._x_dataStack) {
            const data = orderDetailComponent._x_dataStack[0];
            if (data.showStatusModal) {
                data.showStatusModal = false;
            }
            if (data.showEmailModal) {
                data.showEmailModal = false;
            }
        }
    }
    
    // Ctrl/Cmd + P: ì¸ì‡„
    if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
        e.preventDefault();
        const orderDetailComponent = document.querySelector('[x-data*="orderDetail"]');
        if (orderDetailComponent && orderDetailComponent._x_dataStack) {
            orderDetailComponent._x_dataStack[0].printOrder();
        }
    }
    
    // Ctrl/Cmd + E: ì´ë©”ì¼ ëª¨ë‹¬
    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
        e.preventDefault();
        const orderDetailComponent = document.querySelector('[x-data*="orderDetail"]');
        if (orderDetailComponent && orderDetailComponent._x_dataStack) {
            const data = orderDetailComponent._x_dataStack[0];
            if (data.hasCustomerEmail) {
                data.showEmailModal = true;
            }
        }
    }
});

// ì¸ì‡„ ì™„ë£Œ í›„ ì´ë²¤íŠ¸
window.addEventListener('afterprint', function() {
    const printArea = document.querySelector('.print-area');
    if (printArea) {
        printArea.style.display = 'none';
    }
});
</script>
{% endblock %}